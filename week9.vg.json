{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#f5f5f5",
  "width": 800,
  "height": 450,
  "title": "Fatal tornadoes in the US (2011)",
  "projection": {"type": "albersUsa"},
  "config": {
    "view": {
      "stroke": "black",   
      "strokeWidth": 2     
    }
  },
  "layer": [
    {
      "data": {
        "url": "ne_110m_2.json",
        "format": {"type": "topojson", "feature": "ne_110m_admin_1_states_provinces"}
      },
      "mark": {"type": "geoshape", "fill": "white", "stroke": "black"}
    },
    {
      "data": {"graticule": {"step": [5, 5]}},
      "mark": {"type": "geoshape", "stroke": "#ccc", "fill": null}
    },
    {
      "data": {
        "url": "us_tornado_dataset_1950_2021.csv"
      },
      "transform": [
       {
    "filter": "datum.mag != -9 && datum.yr == 2011 && datum.st != 'PR' && datum.st != 'VI' && datum.fat > 0"
    }
      ],
      "mark": {"type": "point", "tooltip": {"content": "data"}},
      "encoding": {
        "longitude": {"field": "slon", "type": "quantitative"},
        "latitude": {"field": "slat", "type": "quantitative"},
        "size": {
          "field": "fat",
          "type": "quantitative",
          "title": "# of fatalities",
          "scale": {"domain": [0, 158], "range": [100, 2000]}
        },
        
        "color": {
          "field": "mag",
          "type": "nominal",
          "legend": {"title": "EF rating (damage)",
    "labelExpr": "datum.label == '0' ? 'F0 (light)' : datum.label == '1' ? 'F1 (moderate)' : datum.label == '2' ? 'F2 (considerable)' : datum.label == '3' ? 'F3 (severe)' : datum.label == '4' ? 'F4 (devastating)' : datum.label == '5' ? 'F5 (incredible)' : datum.label"},
          "scale": { 
    "range": [  
      "#377eb8", 
      "#4daf4a",  
      "#ffd700",  
      "#ff7f00",  
      "#e41a1c" 
    ]}

        },
        "tooltip": [
    {"field": "date", "type": "ordinal", "title": "Date"},
    {"field": "st", "type": "nominal", "title": "State"},
    {"field": "mag", "type": "ordinal", "title": "EF Rating"},
    {"field": "fat", "type": "quantitative", "title": " # of fatalities"},
    {"field": "len", "type": "quantitative", "title": "Track Length (mi)"}
  ]
      }
    }
  ]
}